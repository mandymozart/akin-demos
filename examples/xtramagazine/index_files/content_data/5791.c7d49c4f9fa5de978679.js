"use strict";(self.webpackChunk_scribd_app_monolith=self.webpackChunk_scribd_app_monolith||[]).push([[5791],{43512:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t._getStorageKey=t._getUserStorageKey=void 0;const s=n(73529);function o(e,t,n){var o;if(n)return n(e,t);const r=t&&t.customIDs?t.customIDs:{},i=[`uid:${null!==(o=null==t?void 0:t.userID)&&void 0!==o?o:""}`,`cids:${Object.keys(r).sort(((e,t)=>e.localeCompare(t))).map((e=>`${e}-${r[e]}`)).join(",")}`,`k:${e}`];return(0,s._DJB2)(i.join("|"))}t._getUserStorageKey=o,t._getStorageKey=function(e,t,n){return t?o(e,t,n):(0,s._DJB2)(`k:${e}`)}},30778:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},49065:function(e,t,n){var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t._makeDataAdapterResult=t.DataAdapterCore=void 0;const o=n(49843),r=n(57195),i=n(70857),a=n(80893),l=n(14364);function u(e,t,n,s){return{source:e,data:t,receivedAt:Date.now(),stableID:n,fullUserHash:(0,i._getFullUserHash)(s)}}t.DataAdapterCore=class{constructor(e,t){this._adapterName=e,this._cacheSuffix=t,this._options=null,this._sdkKey=null,this._lastModifiedStoreKey=`statsig.last_modified_time.${t}`,this._inMemoryCache=new c}attach(e,t,n){this._sdkKey=e,this._options=t}getDataSync(e){const t=e&&(0,i._normalizeUser)(e,this._options),n=this._getCacheKey(t),s=this._inMemoryCache.get(n,t);if(s)return s;const o=this._loadFromCache(n);return o?(this._inMemoryCache.add(n,o),this._inMemoryCache.get(n,t)):null}setData(e,t){const n=t&&(0,i._normalizeUser)(t,this._options),s=this._getCacheKey(n);this._inMemoryCache.add(s,u("Bootstrap",e,null,n))}_getDataAsyncImpl(e,t,n){return s(this,void 0,void 0,(function*(){a.Storage.isReady()||(yield a.Storage.isReadyResolver());const s=null!=e?e:this.getDataSync(t),r=[this._fetchAndPrepFromNetwork(s,t,n)];return(null==n?void 0:n.timeoutMs)&&r.push(new Promise((e=>setTimeout(e,n.timeoutMs))).then((()=>(o.Log.debug("Fetching latest value timed out"),null)))),yield Promise.race(r)}))}_prefetchDataImpl(e,t){return s(this,void 0,void 0,(function*(){const n=e&&(0,i._normalizeUser)(e,this._options),s=this._getCacheKey(n),o=yield this._getDataAsyncImpl(null,n,t);o&&this._inMemoryCache.add(s,Object.assign(Object.assign({},o),{source:"Prefetch"}))}))}_fetchAndPrepFromNetwork(e,t,n){var i;return s(this,void 0,void 0,(function*(){const s=null!==(i=null==e?void 0:e.data)&&void 0!==i?i:null,a=null!=e&&this._isCachedResultValidFor204(e,t),c=yield this._fetchFromNetwork(s,t,n,a);if(!c)return o.Log.debug("No response returned for latest value"),null;const d=(0,l._typedJsonParse)(c,"has_updates","Response"),h=this._getSdkKey(),_=r.StableID.get(h);let g=null;if(!0===(null==d?void 0:d.has_updates))g=u("Network",c,_,t);else{if(!s||!1!==(null==d?void 0:d.has_updates))return null;g=u("NetworkNotModified",s,_,t)}const v=this._getCacheKey(t);return this._inMemoryCache.add(v,g),this._writeToCache(v,g),g}))}_getSdkKey(){return null!=this._sdkKey?this._sdkKey:(o.Log.error(`${this._adapterName} is not attached to a Client`),"")}_loadFromCache(e){var t;const n=null===(t=a.Storage.getItem)||void 0===t?void 0:t.call(a.Storage,e);if(null==n)return null;const s=(0,l._typedJsonParse)(n,"source","Cached Result");return s?Object.assign(Object.assign({},s),{source:"Cache"}):null}_writeToCache(e,t){a.Storage.setItem(e,JSON.stringify(t)),this._runLocalStorageCacheEviction(e)}_runLocalStorageCacheEviction(e){var t;const n=null!==(t=(0,a._getObjectFromStorage)(this._lastModifiedStoreKey))&&void 0!==t?t:{};n[e]=Date.now();const s=d(n,10);s&&(delete n[s],a.Storage.removeItem(s)),(0,a._setObjectInStorage)(this._lastModifiedStoreKey,n)}},t._makeDataAdapterResult=u;class c{constructor(){this._data={}}get(e,t){var n;const s=this._data[e],r=null==s?void 0:s.stableID,i=null===(n=null==t?void 0:t.customIDs)||void 0===n?void 0:n.stableID;return i&&r&&i!==r?(o.Log.warn("'StatsigUser.customIDs.stableID' mismatch"),null):s}add(e,t){const n=d(this._data,9);n&&delete this._data[n],this._data[e]=t}merge(e){this._data=Object.assign(Object.assign({},this._data),e)}}function d(e,t){const n=Object.keys(e);return n.length<=t?null:n.reduce(((t,n)=>{const s=e[t],o=e[n];return"object"==typeof s&&"object"==typeof o?o.receivedAt<s.receivedAt?n:t:o<s?n:t}))}},65801:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Diagnostics=void 0;const n=new Map,s="start",o="end",r="statsig::diagnostics";function i(e,t,n,s){return Object.assign({key:n,action:t,step:s,timestamp:Date.now()},e)}function a(e,t){var s;const o=null!==(s=n.get(e))&&void 0!==s?s:[];o.push(t),n.set(e,o)}function l(e,t){if(t in e)return e[t]}t.Diagnostics={_getMarkers:e=>n.get(e),_markInitOverallStart:e=>{a(e,i({},s,"overall"))},_markInitOverallEnd:(e,t,n)=>{a(e,i({success:t,error:t?void 0:{name:"InitializeError",message:"Failed to initialize"},evaluationDetails:n},o,"overall"))},_markInitNetworkReqStart:(e,t)=>{a(e,i(t,s,"initialize","network_request"))},_markInitNetworkReqEnd:(e,t)=>{a(e,i(t,o,"initialize","network_request"))},_markInitProcessStart:e=>{a(e,i({},s,"initialize","process"))},_markInitProcessEnd:(e,t)=>{a(e,i(t,o,"initialize","process"))},_clearMarkers:e=>{n.delete(e)},_formatError(e){if(e&&"object"==typeof e)return{code:l(e,"code"),name:l(e,"name"),message:l(e,"message")}},_getDiagnosticsData(e,n,s,o){var r;return{success:!0===(null==e?void 0:e.ok),statusCode:null==e?void 0:e.status,sdkRegion:null===(r=null==e?void 0:e.headers)||void 0===r?void 0:r.get("x-statsig-region"),isDelta:!0===s.includes('"is_delta":true')||void 0,attempt:n,error:t.Diagnostics._formatError(o)}},_enqueueDiagnosticsEvent(e,n,s,o){const i=t.Diagnostics._getMarkers(s);if(null==i||i.length<=0)return-1;const a=i[i.length-1].timestamp-i[0].timestamp;t.Diagnostics._clearMarkers(s);const l=function(e,t){const n={eventName:r,user:e,value:null,metadata:t,time:Date.now()};return n}(e,{context:"initialize",markers:i.slice(),statsigOptions:o});return n.enqueue(l),a}}},58738:function(e,t){var n=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t._fetchTxtRecords=void 0;const s=new Uint8Array([0,0,1,0,0,1,0,0,0,0,0,0,13,102,101,97,116,117,114,101,97,115,115,101,116,115,3,111,114,103,0,0,16,0,1]),o=["i","e","d"];t._fetchTxtRecords=function(e){return n(this,void 0,void 0,(function*(){const t=yield e("https://cloudflare-dns.com/dns-query",{method:"POST",headers:{"Content-Type":"application/dns-message",Accept:"application/dns-message"},body:s});if(!t.ok){const e=new Error("Failed to fetch TXT records from DNS");throw e.name="DnsTxtFetchError",e}const n=yield t.arrayBuffer();return function(e){const t=e.findIndex(((t,n)=>n<200&&"="===String.fromCharCode(t)&&o.includes(String.fromCharCode(e[n-1]))));if(-1===t){const e=new Error("Failed to parse TXT records from DNS");throw e.name="DnsTxtParseError",e}let n="";for(let s=t-1;s<e.length;s++)n+=String.fromCharCode(e[s]);return n.split(",")}(new Uint8Array(n))}))}},18756:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},33065:function(e,t,n){var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorBoundary=t.EXCEPTION_ENDPOINT=void 0;const o=n(49843),r=n(39561),i=n(78131);t.EXCEPTION_ENDPOINT="https://statsigapi.net/v1/sdk_exception";const a="[Statsig] UnknownError";function l(e){return e instanceof Error?e:"string"==typeof e?new Error(e):new Error("An unknown error occurred.")}function u(e){if(!e)return{};const t={};return Object.entries(e).forEach((([e,n])=>{switch(typeof n){case"number":case"bigint":case"boolean":t[String(e)]=n;break;case"string":n.length<50?t[String(e)]=n:t[String(e)]="set";break;case"object":"environment"===e?t.environment=n:"networkConfig"===e?t.networkConfig=n:t[String(e)]=null!=n?"set":"unset"}})),t}t.ErrorBoundary=class{constructor(e,t,n,s){this._sdkKey=e,this._options=t,this._emitter=n,this._lastSeenError=s,this._seen=new Set}wrap(e){try{const t=e;(function(e){const t=new Set;let n=Object.getPrototypeOf(e);for(;n&&n!==Object.prototype;)Object.getOwnPropertyNames(n).filter((e=>"function"==typeof(null==n?void 0:n[e]))).forEach((e=>t.add(e))),n=Object.getPrototypeOf(n);return Array.from(t)})(t).forEach((n=>{const s=t[n];"$EB"in s||(t[n]=(...t)=>this._capture(n,(()=>s.apply(e,t))),t[n].$EB=!0)}))}catch(e){this._onError("eb:wrap",e)}}logError(e,t){this._onError(e,t)}getLastSeenErrorAndReset(){const e=this._lastSeenError;return this._lastSeenError=void 0,null!=e?e:null}attachErrorIfNoneExists(e){this._lastSeenError||(this._lastSeenError=l(e))}_capture(e,t){try{const n=t();return n&&n instanceof Promise?n.catch((t=>this._onError(e,t))):n}catch(t){return this._onError(e,t),null}}_onError(e,n){try{o.Log.warn(`Caught error in ${e}`,{error:n});(()=>s(this,void 0,void 0,(function*(){var s,o,c,d,h,_,g;const v=n||Error(a),f=v instanceof Error,p=f?v.name:"No Name",m=l(v);if(this._lastSeenError=m,this._seen.has(p))return;if(this._seen.add(p),null===(o=null===(s=this._options)||void 0===s?void 0:s.networkConfig)||void 0===o?void 0:o.preventAllNetworkTraffic)return void(null===(c=this._emitter)||void 0===c||c.call(this,{name:"error",error:n,tag:e}));const y=r.SDKType._get(this._sdkKey),E=i.StatsigMetadataProvider.get(),k=f?v.stack:function(e){try{return JSON.stringify(e)}catch(e){return a}}(v),b=Object.assign({tag:e,exception:p,info:k,statsigOptions:u(this._options)},Object.assign(Object.assign({},E),{sdkType:y})),S=null!==(_=null===(h=null===(d=this._options)||void 0===d?void 0:d.networkConfig)||void 0===h?void 0:h.networkOverrideFunc)&&void 0!==_?_:fetch;yield S(t.EXCEPTION_ENDPOINT,{method:"POST",headers:{"STATSIG-API-KEY":this._sdkKey,"STATSIG-SDK-TYPE":String(y),"STATSIG-SDK-VERSION":String(E.sdkVersion),"Content-Type":"application/json"},body:JSON.stringify(b)}),null===(g=this._emitter)||void 0===g||g.call(this,{name:"error",error:n,tag:e})})))().then((()=>{})).catch((()=>{}))}catch(e){}}}},67653:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},66902:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},49217:function(e,t,n){var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.EventLogger=void 0;const o=n(43512),r=n(73529),i=n(49843),a=n(5653),l=n(82487),u=n(12944),c=n(25935),d=n(80893),h=n(66052),_=n(36038),g={},v="startup",f="gained_focus";class p{static _safeFlushAndForget(e){var t;null===(t=g[e])||void 0===t||t.flush().catch((()=>{}))}static _safeRetryFailedLogs(e){var t;null===(t=g[e])||void 0===t||t._retryFailedLogs(f)}constructor(e,t,n,s){var o,r;this._sdkKey=e,this._emitter=t,this._network=n,this._options=s,this._queue=[],this._lastExposureTimeMap={},this._nonExposedChecks={},this._hasRunQuickFlush=!1,this._creationTime=Date.now(),this._loggingEnabled=null!==(o=null==s?void 0:s.loggingEnabled)&&void 0!==o?o:!0===(null==s?void 0:s.disableLogging)?c.LoggingEnabledOption.disabled:c.LoggingEnabledOption.browserOnly,(null==s?void 0:s.loggingEnabled)&&void 0!==s.disableLogging&&i.Log.warn("Detected both loggingEnabled and disableLogging options. loggingEnabled takes precedence - please remove disableLogging."),this._maxQueueSize=null!==(r=null==s?void 0:s.loggingBufferMaxSize)&&void 0!==r?r:100;const l=null==s?void 0:s.networkConfig;this._logEventUrlConfig=new h.UrlConfiguration(a.Endpoint._rgstr,null==l?void 0:l.logEventUrl,null==l?void 0:l.api,null==l?void 0:l.logEventFallbackUrls)}setLogEventCompressionMode(e){this._network.setLogEventCompressionMode(e)}setLoggingEnabled(e){this._loggingEnabled=e}enqueue(e){this._shouldLogEvent(e)&&(this._normalizeAndAppendEvent(e),this._quickFlushIfNeeded(),this._queue.length>this._maxQueueSize&&p._safeFlushAndForget(this._sdkKey))}incrementNonExposureCount(e){var t;const n=null!==(t=this._nonExposedChecks[e])&&void 0!==t?t:0;this._nonExposedChecks[e]=n+1}reset(){this._lastExposureTimeMap={}}start(){var e;const t=(0,l._isServerEnv)();t&&"always"!==(null===(e=this._options)||void 0===e?void 0:e.loggingEnabled)||(g[this._sdkKey]=this,t||(0,_._subscribeToVisiblityChanged)((e=>{"background"===e?p._safeFlushAndForget(this._sdkKey):"foreground"===e&&p._safeRetryFailedLogs(this._sdkKey)})),this._retryFailedLogs(v),this._startBackgroundFlushInterval())}stop(){return s(this,void 0,void 0,(function*(){this._flushIntervalId&&(clearInterval(this._flushIntervalId),this._flushIntervalId=null),delete g[this._sdkKey],yield this.flush()}))}flush(){return s(this,void 0,void 0,(function*(){if(this._appendAndResetNonExposedChecks(),0===this._queue.length)return;const e=this._queue;this._queue=[],yield this._sendEvents(e)}))}_quickFlushIfNeeded(){this._hasRunQuickFlush||(this._hasRunQuickFlush=!0,Date.now()-this._creationTime>200||setTimeout((()=>p._safeFlushAndForget(this._sdkKey)),200))}_shouldLogEvent(e){var t;if("always"!==(null===(t=this._options)||void 0===t?void 0:t.loggingEnabled)&&(0,l._isServerEnv)())return!1;if(!(0,u._isExposureEvent)(e))return!0;const n=e.user?e.user:{statsigEnvironment:void 0},s=(0,o._getUserStorageKey)(this._sdkKey,n),r=e.metadata?e.metadata:{},i=[e.eventName,s,r.gate,r.config,r.ruleID,r.allocatedExperiment,r.parameterName,String(r.isExplicitParameter),r.reason].join("|"),a=this._lastExposureTimeMap[i],c=Date.now();return!(a&&c-a<6e5)&&(Object.keys(this._lastExposureTimeMap).length>1e3&&(this._lastExposureTimeMap={}),this._lastExposureTimeMap[i]=c,!0)}_sendEvents(e){var t,n;return s(this,void 0,void 0,(function*(){if("disabled"===this._loggingEnabled)return this._saveFailedLogsToStorage(e),!1;try{const s=(0,_._isUnloading)()&&this._network.isBeaconSupported()&&null==(null===(n=null===(t=this._options)||void 0===t?void 0:t.networkConfig)||void 0===n?void 0:n.networkOverrideFunc);this._emitter({name:"pre_logs_flushed",events:e});return(s?this._sendEventsViaBeacon(e):yield this._sendEventsViaPost(e)).success?(this._emitter({name:"logs_flushed",events:e}),!0):(i.Log.warn("Failed to flush events."),this._saveFailedLogsToStorage(e),!1)}catch(e){return i.Log.warn("Failed to flush events."),!1}}))}_sendEventsViaPost(e){var t;return s(this,void 0,void 0,(function*(){const n=yield this._network.post(this._getRequestData(e)),s=null!==(t=null==n?void 0:n.code)&&void 0!==t?t:-1;return{success:s>=200&&s<300}}))}_sendEventsViaBeacon(e){return{success:this._network.beacon(this._getRequestData(e))}}_getRequestData(e){return{sdkKey:this._sdkKey,data:{events:e},urlConfig:this._logEventUrlConfig,retries:3,isCompressable:!0,params:{[a.NetworkParam.EventCount]:String(e.length)},credentials:"same-origin"}}_saveFailedLogsToStorage(e){for(;e.length>500;)e.shift();const t=this._getStorageKey();try{(0,d._setObjectInStorage)(t,e)}catch(e){i.Log.warn("Unable to save failed logs to storage")}}_retryFailedLogs(e){const t=this._getStorageKey();(()=>s(this,void 0,void 0,(function*(){d.Storage.isReady()||(yield d.Storage.isReadyResolver());const n=(0,d._getObjectFromStorage)(t);if(!n)return;e===v&&d.Storage.removeItem(t);(yield this._sendEvents(n))&&e===f&&d.Storage.removeItem(t)})))().catch((()=>{i.Log.warn("Failed to flush stored logs")}))}_getStorageKey(){return`statsig.failed_logs.${(0,r._DJB2)(this._sdkKey)}`}_normalizeAndAppendEvent(e){e.user&&(e.user=Object.assign({},e.user),delete e.user.privateAttributes);const t={},n=this._getCurrentPageUrl();n&&(t.statsigMetadata={currentPage:n});const s=Object.assign(Object.assign({},e),t);i.Log.debug("Enqueued Event:",s),this._queue.push(s)}_appendAndResetNonExposedChecks(){0!==Object.keys(this._nonExposedChecks).length&&(this._normalizeAndAppendEvent({eventName:"statsig::non_exposed_checks",user:null,time:Date.now(),metadata:{checks:Object.assign({},this._nonExposedChecks)}}),this._nonExposedChecks={})}_getCurrentPageUrl(){var e;if(!1!==(null===(e=this._options)||void 0===e?void 0:e.includeCurrentPageUrlWithEvents))return(0,l._getCurrentPageUrlSafe)()}_startBackgroundFlushInterval(){var e,t;const n=null!==(t=null===(e=this._options)||void 0===e?void 0:e.loggingIntervalMs)&&void 0!==t?t:1e4,s=setInterval((()=>{const e=g[this._sdkKey];e&&e._flushIntervalId===s?p._safeFlushAndForget(this._sdkKey):clearInterval(s)}),n);this._flushIntervalId=s}}t.EventLogger=p},73529:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t._getSortedObject=t._DJB2Object=t._DJB2=void 0;const s=n(10725);t._DJB2=e=>{let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return String(t>>>0)};t._DJB2Object=(e,n)=>(0,t._DJB2)(JSON.stringify((0,t._getSortedObject)(e,n)));t._getSortedObject=(e,n)=>{if(null==e)return null;const o=Object.keys(e).sort(),r={};return o.forEach((o=>{const i=e[o];0!==n&&"object"===(0,s._typeOf)(i)?r[o]=(0,t._getSortedObject)(i,null!=n?n-1:n):r[o]=i})),r}}}]);
//# sourceMappingURL=https://www.scribd.com/webpack/monolith/5791.c7d49c4f9fa5de978679.js.map