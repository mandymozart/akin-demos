"use strict";(self.webpackChunk_scribd_app_monolith=self.webpackChunk_scribd_app_monolith||[]).push([[4627],{87721:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SessionReplay=e.runStatsigSessionReplay=e.StatsigSessionReplayPlugin=void 0;const i=s(253),n=s(97632),o=s(77120);function r(t,e){new a(t,e)}e.StatsigSessionReplayPlugin=class{constructor(t){this.options=t,this.__plugin="session-replay"}bind(t){r(t,this.options)}},e.runStatsigSessionReplay=r;class a extends n.SessionReplayBase{constructor(t,e){var s;super(t,e),this._client.$on("values_updated",(()=>{var t;this._wasStopped||this._attemptToStartRecording(null===(t=this._options)||void 0===t?void 0:t.forceRecording)})),this._attemptToStartRecording(null===(s=this._options)||void 0===s?void 0:s.forceRecording)}_shutdown(t){super._shutdownImpl(t)}_attemptToStartRecording(t=!1){var e,s;if(this._totalLogs>=o.MAX_LOGS)return;const n=this._client.getContext().values;!0!==(null==n?void 0:n.recording_blocked)&&(t||!0===(null==n?void 0:n.can_record_session))&&!1!==(null==n?void 0:n.passes_session_recording_targeting)?this._replayer.isRecording()||(this._wasStopped=!1,i.StatsigMetadataProvider.add({isRecordingSession:"true"}),this._replayer.record(((t,e)=>this._onRecordingEvent(t,e)),null!==(s=null===(e=this._options)||void 0===e?void 0:e.rrwebConfig)&&void 0!==s?s:{},(()=>{this._shutdown()}))):this._shutdown()}}e.SessionReplay=a},97632:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SessionReplayBase=e.forceStartRecording=e.startRecording=e.stopRecording=void 0;const i=s(253),n=s(74654),o=s(77120),r=s(85604);function a(t){var e,s;const n=null==t?(0,i._getStatsigGlobal)().firstSRInstance:null===(s=null===(e=(0,i._getStatsigGlobal)())||void 0===e?void 0:e.srInstances)||void 0===s?void 0:s[t];return n instanceof l?n:null}e.stopRecording=function(t){var e;null===(e=a(t))||void 0===e||e.stopRecording()},e.startRecording=function(t){var e;null===(e=a(t))||void 0===e||e.startRecording()},e.forceStartRecording=function(t){var e;null===(e=a(t))||void 0===e||e.forceStartRecording()};class l{constructor(t,e){this._sessionData={startTime:-1,endTime:0,clickCount:0},this._events=[],this._wasStopped=!1,this._currentEventIndex=0,this._totalLogs=0,this._client=t,this._options=e;const{sdkKey:s,errorBoundary:o}=this._client.getContext();if(this._errorBoundary=o,this._errorBoundary.wrap(this),this._replayer=new n.SessionReplayClient,this._client.$on("pre_shutdown",(()=>this._shutdown())),this._client.on("session_expired",(()=>{this._shutdown("session_expired")})),!(0,i._isServerEnv)()){const t=(0,i._getStatsigGlobal)();t.srInstances=Object.assign(Object.assign({},t.srInstances),{[s]:this}),t.firstSRInstance||(t.firstSRInstance=this)}this._currentSessionID=this._getSessionIdFromClient(),this._subscribeToVisibilityChanged()}forceStartRecording(){this._wasStopped=!1,this._attemptToStartRecording(!0)}stopRecording(){this._wasStopped=!0,this._shutdown()}startRecording(){var t;this._wasStopped=!1,this._attemptToStartRecording(null===(t=this._options)||void 0===t?void 0:t.forceRecording)}isRecording(){return this._replayer.isRecording()}_logRecording(t){0!==this._events.length&&(t=(0,i._isUnloading)()?"is_leaving_page":t,this._logRecordingWithSessionID(this._currentSessionID,t))}_onVisibilityChanged(t){"background"===t&&(this._logRecording(),this._client.flush().catch((t=>{this._errorBoundary.logError("SR::visibility",t)})))}_subscribeToVisibilityChanged(){const{sdkKey:t}=this._client.getContext();(0,i._subscribeToVisiblityChanged)((e=>{var s,n;const o=null===(n=null===(s=(0,i._getStatsigGlobal)())||void 0===s?void 0:s.srInstances)||void 0===n?void 0:n[t];o instanceof l&&o._onVisibilityChanged(e)}))}_logRecordingWithSessionID(t,e){const s=this._sessionData;if(0===this._events.length)return;const n=JSON.stringify(this._events),r=(0,o._slicePayload)(n),a=r.length>1?(0,i.getUUID)():null;for(let l=0;l<r.length;l++){const _=r[l],d=(0,o._makeLoggableRrwebEvent)(_,n,t,s);null!=a&&(0,o._appendSlicedMetadata)(d.metadata,a,l,r.length,_.length),e&&(d.metadata[e]="true"),this._totalLogs++,this._client.logEvent(d),null!=a&&this._client.flush().catch((t=>{i.Log.error(t)}))}this._events=[],this._totalLogs>o.MAX_LOGS&&this._shutdown()}_bumpSessionIdleTimerAndLogRecording(){this._getSessionIdFromClient(),this._logRecording()}_getSessionIdFromClient(){return this._client.getContext().session.data.sessionID}_shutdownImpl(t){this._replayer.isRecording()&&(this._replayer.stop(),i.StatsigMetadataProvider.add({isRecordingSession:"false"})),0!==this._events.length?(this._logRecording(t),"session_expired"===t&&(this._currentEventIndex=0,this._sessionData=this._makeEmptySessionData())):"session_expired"===t&&(this._currentEventIndex=0,this._sessionData=this._makeEmptySessionData())}_makeEmptySessionData(){return{startTime:-1,endTime:0,clickCount:0}}_onRecordingEvent(t,e){if(this._currentSessionID!==this._getSessionIdFromClient())return void this._shutdown("session_expired");if(this._totalLogs>=o.MAX_LOGS)return void this._shutdown();t.eventIndex=this._currentEventIndex++,this._sessionData.clickCount+=e.clickCount,this._sessionData.startTime=-1===this._sessionData.startTime?e.startTime:Math.min(this._sessionData.startTime,e.startTime),this._sessionData.endTime=Math.max(this._sessionData.endTime,e.endTime);const s=(0,r._fastApproxSizeOf)(t,o.MAX_INDIVIDUAL_EVENT_BYTES);if(s>o.MAX_INDIVIDUAL_EVENT_BYTES)return void i.Log.warn(`SessionReplay event is too large (~${s} bytes) and will not be logged`,t);const n=(0,r._fastApproxSizeOf)(this._events,o.REPLAY_ENQUEUE_TRIGGER_BYTES);this._events.push(t),n+s<o.REPLAY_ENQUEUE_TRIGGER_BYTES||((0,i._isCurrentlyVisible)()?this._bumpSessionIdleTimerAndLogRecording():this._logRecording())}}e.SessionReplayBase=l},74654:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SessionReplayClient=void 0;const i=s(36699),n=s(253);e.SessionReplayClient=class{constructor(){this._startTimestamp=null,this._endTimestamp=null}record(t,e,s,o=!1){if(null==(0,n._getDocumentSafe)())return;if(this._startTimestamp=null,this._endTimestamp=null,this._stopCallback=s,this._stopFn)return;this._stopFn=function(t,e,s){const n="function"==typeof i?i:i.record;return n(s?Object.assign(Object.assign({},e),{emit:t,checkoutEveryNms:3e4}):Object.assign(Object.assign({},e),{emit:t}))}(((e,s)=>{var i,n,r;o?this._startTimestamp=s?e.timestamp:null!==(i=this._startTimestamp)&&void 0!==i?i:e.timestamp:null!==(n=this._startTimestamp)&&void 0!==n||(this._startTimestamp=e.timestamp),this._endTimestamp=e.timestamp;let a=0;(function(t){return 3===t.type&&2===t.data.source&&(2===t.data.type||4===t.data.type)})(e)&&a++,t(Object.assign(Object.assign({},e),{eventIndex:0}),{startTime:this._startTimestamp,endTime:this._endTimestamp,clickCount:a},null!=s&&s),this._endTimestamp-this._startTimestamp>144e5&&(null===(r=this._stopFn)||void 0===r||r.call(this),this._stopCallback&&this._stopCallback())}),e,o)}stop(){this._stopFn&&(this._stopFn(),this._stopFn=void 0)}isRecording(){return null!=this._stopFn}}},77120:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e._appendSlicedMetadata=e._slicePayload=e._makeLoggableRrwebEvent=e.MAX_LOGS=e.MAX_INDIVIDUAL_EVENT_BYTES=e.REPLAY_ENQUEUE_TRIGGER_BYTES=void 0;const i=s(253),n=1048576;e.REPLAY_ENQUEUE_TRIGGER_BYTES=10240,e.MAX_INDIVIDUAL_EVENT_BYTES=10485760,e.MAX_LOGS=1e4,e._makeLoggableRrwebEvent=function(t,e,s,n){return{eventName:"statsig::session_recording",value:s,metadata:{session_start_ts:String(n.startTime),session_end_ts:String(n.endTime),clicks_captured_cumulative:String(n.clickCount),rrweb_events:t,rrweb_payload_size:String(e.length),session_replay_sdk_version:i.SDK_VERSION}}},e._slicePayload=function(t){const e=[];for(let s=0;s<t.length;s+=n)e.push(t.slice(s,s+n));return e},e._appendSlicedMetadata=function(t,e,s,i,n){t.sliced_id=e,t.slice_index=String(s),t.slice_count=String(i),t.slice_byte_size=String(n)}},85604:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e._fastApproxSizeOf=void 0;e._fastApproxSizeOf=(t,s)=>{let i=0;const n=Object.keys(t);for(let o=0;o<n.length;o++){const r=n[o],a=t[r];if(i+=r.length,i+="object"==typeof a&&null!==a?(0,e._fastApproxSizeOf)(a,s)+2:String(a).length+1,i>=s)return i}return i}},78648:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TriggeredSessionReplay=e.runStatsigTriggeredSessionReplay=e.StatsigTriggeredSessionReplayPlugin=void 0;const i=s(253),n=s(97632),o=s(77120);function r(t,e){new a(t,e)}e.StatsigTriggeredSessionReplayPlugin=class{constructor(t){this.options=t,this.__plugin="triggered-session-replay"}bind(t){r(t,this.options)}},e.runStatsigTriggeredSessionReplay=r;class a extends n.SessionReplayBase{constructor(t,e){var s;super(t,e),this._runningEventData=[],this._isActiveRecording=!1,this._subscribeToClientEvents(e),(null==e?void 0:e.autoStartRecording)?this._attemptToStartRecording(null===(s=this._options)||void 0===s?void 0:s.forceRecording):(null==e?void 0:e.keepRollingWindow)&&this._attemptToStartRollingWindow()}_subscribeToClientEvents(t){this._subscribeToValuesUpdated(t),this._subscribeToLogEventCalled(),this._subscribeToGateEvaluation(),this._subscribeToExperimentEvaluation()}_subscribeToValuesUpdated(t){this._client.$on("values_updated",(()=>{var e;this._wasStopped||((null==t?void 0:t.autoStartRecording)?this._attemptToStartRecording(null===(e=this._options)||void 0===e?void 0:e.forceRecording):(null==t?void 0:t.keepRollingWindow)&&this._attemptToStartRollingWindow())}))}_subscribeToLogEventCalled(){this._client.$on("log_event_called",(t=>{var e;if(this._wasStopped)return;const s=this._client.getContext().values;if(!1===(null==s?void 0:s.passes_session_recording_targeting)||null==(null==s?void 0:s.session_recording_event_triggers))return;const i=s.session_recording_event_triggers[t.event.eventName];if(null==i)return;if(!1===i.passes_sampling)return;const n=i.values;null!=n?n.includes(String(null!==(e=t.event.value)&&void 0!==e?e:""))&&this._attemptToStartRecording(!0):this._attemptToStartRecording(!0)}))}_subscribeToGateEvaluation(){this._client.$on("gate_evaluation",(t=>{this._tryStartExposureRecording(t.gate.name,String(t.gate.value))}))}_subscribeToExperimentEvaluation(){this._client.$on("experiment_evaluation",(t=>{var e;this._tryStartExposureRecording(t.experiment.name,null!==(e=t.experiment.groupName)&&void 0!==e?e:"")}))}_tryStartExposureRecording(t,e){var s;if(this._wasStopped)return;const n=this._client.getContext().values;if(!1===(null==n?void 0:n.passes_session_recording_targeting)||null==(null==n?void 0:n.session_recording_exposure_triggers))return;const o=null!==(s=n.session_recording_exposure_triggers[t])&&void 0!==s?s:n.session_recording_exposure_triggers[(0,i._DJB2)(t)];if(null==o)return;if(!1===o.passes_sampling)return;const r=o.values;null!=r?r.includes(e)&&this._attemptToStartRecording(!0):this._attemptToStartRecording(!0)}forceStartRecording(){super.forceStartRecording()}stopRecording(){this._isActiveRecording=!1,this._runningEventData=[],super.stopRecording()}_handleStartActiveRecording(){if(this._isActiveRecording=!0,0===this._runningEventData.length)return;const t=this._runningEventData.map((t=>t.events)).flat();for(let e=0;e<t.length;e++)t[e].event.eventIndex=e,this._sessionData.clickCount+=t[e].data.clickCount,this._sessionData.startTime=-1===this._sessionData.startTime?t[e].data.startTime:Math.min(this._sessionData.startTime,t[e].data.startTime),this._sessionData.endTime=Math.max(this._sessionData.endTime,t[e].data.endTime);this._events=t.map((t=>t.event)),this._currentEventIndex=t.length,(0,i._isCurrentlyVisible)()?this._bumpSessionIdleTimerAndLogRecording():this._logRecording(),this._replayer.stop()}_shutdown(t){this._isActiveRecording=!1,this._runningEventData=[],super._shutdownImpl(t)}_onRecordingEvent(t,e,s){if(!this._isActiveRecording)return this._currentSessionID!==this._getSessionIdFromClient()?void this._shutdown("session_expired"):void(s&&4===t.type||0===this._runningEventData.length?(this._runningEventData.length>1&&this._runningEventData.shift(),this._runningEventData.push({events:[{event:t,data:e}]})):this._runningEventData[this._runningEventData.length-1].events.push({event:t,data:e}));super._onRecordingEvent(t,e)}_attemptToStartRollingWindow(){var t,e;const s=this._client.getContext().values;!1!==(null==s?void 0:s.passes_session_recording_targeting)?this._replayer.isRecording()||this._replayer.record(((t,e,s)=>this._onRecordingEvent(t,e,s)),null!==(e=null===(t=this._options)||void 0===t?void 0:t.rrwebConfig)&&void 0!==e?e:{},(()=>{this._shutdown()}),!0):this._shutdown()}_attemptToStartRecording(t=!1){var e,s;if(this._totalLogs>=o.MAX_LOGS)return;const n=this._client.getContext().values;!0!==(null==n?void 0:n.recording_blocked)&&(t||!0===(null==n?void 0:n.can_record_session))&&!1!==(null==n?void 0:n.passes_session_recording_targeting)?(this._handleStartActiveRecording(),this._wasStopped=!1,i.StatsigMetadataProvider.add({isRecordingSession:"true"}),this._replayer.isRecording()||this._replayer.record(((t,e,s)=>this._onRecordingEvent(t,e,s)),null!==(s=null===(e=this._options)||void 0===e?void 0:e.rrwebConfig)&&void 0!==s?s:{},(()=>{this._shutdown()}))):this._shutdown()}}e.TriggeredSessionReplay=a},8510:(t,e,s)=>{e.cb=void 0;const i=s(253),n=s(87721);Object.defineProperty(e,"cb",{enumerable:!0,get:function(){return n.StatsigSessionReplayPlugin}});const o=s(97632);const r=s(74654);const a=s(78648);Object.assign((0,i._getStatsigGlobal)(),{SessionReplayClient:r.SessionReplayClient,SessionReplay:n.SessionReplay,runStatsigSessionReplay:n.runStatsigSessionReplay,runStatsigTriggeredSessionReplay:a.runStatsigTriggeredSessionReplay,StatsigSessionReplayPlugin:n.StatsigSessionReplayPlugin,StatsigTriggeredSessionReplayPlugin:a.StatsigTriggeredSessionReplayPlugin,startRecording:o.startRecording,stopRecording:o.stopRecording,forceStartRecording:o.forceStartRecording})},58758:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AutoCaptureEventName=void 0,e.AutoCaptureEventName={PAGE_VIEW:"auto_capture::page_view",PAGE_VIEW_END:"auto_capture::page_view_end",ERROR:"auto_capture::error",SESSION_START:"auto_capture::session_start",PERFORMANCE:"auto_capture::performance",FORM_SUBMIT:"auto_capture::form_submit",CLICK:"auto_capture::click",RAGE_CLICK:"auto_capture::rage_click"}}}]);
//# sourceMappingURL=https://www.scribd.com/webpack/monolith/4627.e0a7e63bfca3832ef073.js.map