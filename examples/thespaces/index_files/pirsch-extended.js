(()=>{function F(t){let i=document.querySelector(t);if(!i)throw`Pirsch script ${t} tag not found!`;return i}function s(t,i){let e="";return t.length>0&&(i<t.length?e=t[i]:e=t[t.length-1]),e}function T(t){let i={};for(let e of t.attributes)e.name.startsWith("data-tag-")?i[e.name.substring(9).replaceAll("-"," ")]=e.value||"1":e.name.startsWith("data-tag")&&e.value&&e.value.split(",").forEach(n=>{n=n.trim().replaceAll("-"," "),n&&(i[n]="1")});return i}function $(t){return localStorage.getItem("disable_pirsch")||at(t)||!ot(t)||st(t)}function R(t){return t?t=location.href.replace(location.hostname,t):t=location.href,t}function C(t,i,e){t||(t=location.href),i||(i=""),e||(e="");let n=new URL(t);return n.pathname=i+n.pathname+e,n.toString()}function I(t,i){let e=document.title;return t||(t=""),i||(i=""),t+e+i}function N(t){let i=document.referrer;return t&&(i=i.replace(location.hostname,t)),i}function _(t){try{let i=new URL(t);return i.search="",i.toString()}catch{return t}}function U(t){try{let i=new URL(t);return i.hash="",i.toString()}catch{return t}}function at(t){return!t.hasAttribute("data-dev")&&(/^localhost(.*)$|^127(\.[0-9]{1,3}){3}$/is.test(location.hostname)||location.protocol==="file:")?(console.info("Pirsch is ignored on localhost. Add the data-dev attribute to enable it."),!0):!1}function ot(t){try{let i=t.getAttribute("data-include"),e=i?i.split(","):[];if(e.length){let n=!1;for(let o=0;o<e.length;o++)if(new RegExp(e[o]).test(location.pathname)){n=!0;break}if(!n)return!1}}catch(i){console.error(i)}return!0}function st(t){try{let i=t.getAttribute("data-exclude"),e=i?i.split(","):[];for(let n=0;n<e.length;n++)if(new RegExp(e[n]).test(location.pathname))return!0}catch(i){console.error(i)}return!1}function M(t){if(history.pushState&&!t.disableHistory){let i=history.pushState;history.pushState=function(e,n,o){i.apply(this,[e,n,o]),Q(t)},window.addEventListener("popstate",()=>Q(t))}document.body?Q(t):window.addEventListener("DOMContentLoaded",()=>Q(t))}function Q(t){let{script:i,domains:e,rewrite:n,pathPrefix:o,pathSuffix:u,titlePrefix:l,titleSuffix:f,identificationCode:c,endpoint:m,disableQueryParams:g,disableReferrer:v,disableResolution:P,stripAnchor:S}=t;j({script:i,hostname:n,pathPrefix:e.length?"":s(o,0),pathSuffix:e.length?"":s(u,0),titlePrefix:e.length?"":s(l,0),titleSuffix:e.length?"":s(f,0),identificationCode:c,endpoint:m,disableQueryParams:g,disableReferrer:v,disableResolution:P,stripAnchor:S});for(let d=0;d<e.length;d++){let[b,w]=e[d].split(":");j({script:i,hostname:b,pathPrefix:s(o,d),pathSuffix:s(u,d),titlePrefix:s(l,d),titleSuffix:s(f,d),identificationCode:w,endpoint:m,disableQueryParams:g,disableReferrer:v,disableResolution:P,stripAnchor:S})}}function j(t){let{script:i,hostname:e,pathPrefix:n,pathSuffix:o,titlePrefix:u,titleSuffix:l,identificationCode:f,endpoint:c,disableQueryParams:m,disableReferrer:g,disableResolution:v,stripAnchor:P}=t,S=N(e);e=R(e),e=C(e,n,o),e=m?_(e):e,e=P?U(e):e;let d=T(i),b=c+"?nc="+new Date().getTime()+"&code="+f+"&url="+encodeURIComponent(e.substring(0,1800))+"&t="+encodeURIComponent(I(u,l))+"&ref="+(g?"":encodeURIComponent(S))+"&w="+(v?"":screen.width)+"&h="+(v?"":screen.height)+(Object.keys(d).length?"&"+Object.entries(d).map(([y,x])=>`tag_${y.replaceAll("-"," ")}=${x||1}`).join("&"):""),w=new XMLHttpRequest;w.open("GET",b),w.send()}function z(){window.pirsch=function(t,i){return console.log(`Pirsch event: ${t}${i?" "+JSON.stringify(i):""}`),Promise.resolve(null)}}function B(t){let{script:i,domains:e,rewrite:n,pathPrefix:o,pathSuffix:u,titlePrefix:l,titleSuffix:f,identificationCode:c,endpoint:m,disableQueryParams:g,disableReferrer:v,disableResolution:P,stripAnchor:S}=t;window.pirsch=function(d,b){return typeof d!="string"||!d?Promise.reject("The event name for Pirsch is invalid (must be a non-empty string)! Usage: pirsch('event name', {duration: 42, meta: {key: 'value'}})"):new Promise((w,y)=>{let x=b&&b.meta?b.meta:{};for(let h in x)x.hasOwnProperty(h)&&(x[h]=String(x[h]));V({script:i,hostname:n,pathPrefix:e.length?"":s(o,0),pathSuffix:e.length?"":s(u,0),titlePrefix:e.length?"":s(l,0),titleSuffix:e.length?"":s(f,0),identificationCode:c,endpoint:m,disableQueryParams:g,disableReferrer:v,disableResolution:P,stripAnchor:S,name:d,options:b,meta:x,non_interactive:t.non_interactive,resolve:w,reject:y});for(let h=0;h<e.length;h++){let[E,k]=e[h].split(":");V({script:i,hostname:E,pathPrefix:s(o,h),pathSuffix:s(u,h),titlePrefix:s(l,h),titleSuffix:s(f,h),identificationCode:k,endpoint:m,disableQueryParams:g,disableReferrer:v,disableResolution:P,stripAnchor:S,name:d,options:b,meta:x,non_interactive:t.non_interactive,resolve:w,reject:y})}})}}function V(t){let{script:i,hostname:e,pathPrefix:n,pathSuffix:o,titlePrefix:u,titleSuffix:l,identificationCode:f,endpoint:c,disableQueryParams:m,disableReferrer:g,disableResolution:v,stripAnchor:P,name:S,options:d,meta:b,non_interactive:w,resolve:y,reject:x}=t,h=N(e),E=T(i);e=R(e),e=C(e,n,o),e=m?_(e):e,e=P?U(e):e,navigator.sendBeacon(c,JSON.stringify({identification_code:f,url:e.substring(0,1800),title:I(u,l),referrer:g?"":encodeURIComponent(h),screen_width:v?0:screen.width,screen_height:v?0:screen.height,tags:E,event_name:S,event_duration:d&&d.duration&&typeof d.duration=="number"?d.duration:0,event_meta:b,non_interactive:w}))?y():x("error queuing event request")}function X(t){let{script:i,domains:e,rewrite:n,pathPrefix:o,pathSuffix:u,identificationCode:l,endpoint:f,disableQueryParams:c}=t,m=Number.parseInt(i.getAttribute("data-interval-ms"),10)||6e4,g=setInterval(()=>{ct({domains:e,rewrite:n,pathPrefix:o,pathSuffix:u,identificationCode:l,endpoint:f,disableQueryParams:c})},m);window.pirschClearSession=()=>{clearInterval(g)}}function ct(t){let{domains:i,rewrite:e,pathPrefix:n,pathSuffix:o,identificationCode:u,endpoint:l,disableQueryParams:f}=t;J({hostname:e,pathPrefix:i.length?"":s(n,0),pathSuffix:i.length?"":s(o,0),identificationCode:u,endpoint:l,disableQueryParams:f});for(let c=0;c<i.length;c++){let[m,g]=i[c].split(":");J({hostname:m,pathPrefix:s(n,c),pathSuffix:s(o,c),identificationCode:g,endpoint:l,disableQueryParams:f})}}function J(t){let{hostname:i,pathPrefix:e,pathSuffix:n,identificationCode:o,endpoint:u,disableQueryParams:l}=t;i=R(i),i=C(i,e,n),l&&(i=i.includes("?")?i.split("?")[0]:i);let f=u+"?nc="+new Date().getTime()+"&code="+o+"&url="+encodeURIComponent(i.substring(0,1800)),c=new XMLHttpRequest;c.open("POST",f),c.send()}(function(){"use strict";z();let t=F("#pirschextendedjs");if($(t))return;let i=["7z","avi","csv","docx","exe","gz","key","midi","mov","mp3","mp4","mpeg","pdf","pkg","pps","ppt","pptx","rar","rtf","txt","wav","wma","wmv","xlsx","zip"].concat(t.getAttribute("data-download-extensions")?.split(",")||[]),e=t.getAttribute("data-hit-endpoint")||"https://api.pirsch.io/hit",n=t.getAttribute("data-event-endpoint")||"https://api.pirsch.io/event",o=t.getAttribute("data-session-endpoint")||"https://api.pirsch.io/session",u=t.getAttribute("data-code")||"not-set",l=t.getAttribute("data-domain")?t.getAttribute("data-domain").split(",")||[]:[],f=t.hasAttribute("data-disable-page-views"),c=t.hasAttribute("data-disable-query"),m=t.hasAttribute("data-disable-referrer"),g=t.hasAttribute("data-disable-resolution"),v=t.hasAttribute("data-disable-history"),P=t.hasAttribute("data-disable-outbound-links"),S=t.hasAttribute("data-disable-downloads"),d=t.hasAttribute("data-enable-sessions"),b=t.getAttribute("data-dev"),w=t.getAttribute("data-path-prefix")?t.getAttribute("data-path-prefix").split(",")||[]:[],y=t.getAttribute("data-path-suffix")?t.getAttribute("data-path-suffix").split(",")||[]:[],x=t.getAttribute("data-title-prefix")?t.getAttribute("data-title-prefix").split(",")||[]:[],h=t.getAttribute("data-title-suffix")?t.getAttribute("data-title-suffix").split(",")||[]:[],E=t.getAttribute("data-outbound-link-event-name")||"Outbound Link Click",k=t.getAttribute("data-download-event-name")||"File Download",G=t.getAttribute("data-not-found-event-name")||"404 Page Not Found";f||M({script:t,domains:l,rewrite:b,pathPrefix:w,pathSuffix:y,titlePrefix:x,titleSuffix:h,identificationCode:u,endpoint:e,disableQueryParams:c,disableReferrer:m,disableResolution:g,disableHistory:v}),d&&X({script:t,domains:l,rewrite:b,pathPrefix:w,pathSuffix:y,titlePrefix:x,titleSuffix:h,identificationCode:u,endpoint:o,disableQueryParams:c}),B({script:t,domains:l,rewrite:b,pathPrefix:w,pathSuffix:y,titlePrefix:x,titleSuffix:h,identificationCode:u,endpoint:n,disableQueryParams:c,disableReferrer:m,disableResolution:g}),window.pirschInit=function(){q("[data-pirsch-event]"),q("[pirsch-event]"),K(),Y(),rt()},document.addEventListener("DOMContentLoaded",pirschInit);function q(a){let r=document.querySelectorAll(a);for(let A of r)A.addEventListener("click",()=>{H(A)}),A.addEventListener("auxclick",()=>{H(A)})}function H(a){let r=a.getAttribute("pirsch-event")??a.getAttribute("data-pirsch-event");if(!r){console.error("Pirsch event attribute name can not be empty!",a);return}let A={},L;for(let p of a.attributes)p.name.startsWith("data-pirsch-meta-")?A[p.name.substring(17)]=p.value:p.name.startsWith("pirsch-meta-")?A[p.name.substring(12)]=p.value:(p.name.startsWith("data-pirsch-duration")||p.name.startsWith("pirsch-duration"))&&(L=Number.parseInt(p.value,10)??0);pirsch(r,{meta:A,duration:L})}function K(){let a=document.querySelectorAll("[class*='pirsch-event=']");for(let r of a)r.addEventListener("click",()=>{W(r)}),r.addEventListener("auxclick",()=>{W(r)})}function W(a){let r="",A={},L;for(let p of a.classList)if(p.startsWith("pirsch-event=")){if(r=p.substring(13).replaceAll("+"," "),!r){console.error("Pirsch event class name can not be empty!",a);return}}else if(p.startsWith("pirsch-meta-")){let D=p.substring(12);if(D){let O=D.split("=");O.length===2&&O[1]!==""&&(A[O[0]]=O[1].replaceAll("+"," "))}}else p.startsWith("pirsch-duration=")&&(L=Number.parseInt(p.substring(16))??0);pirsch(r,{meta:A,duration:L})}function Y(){let a=document.getElementsByTagName("a");for(let r of a)!r.hasAttribute("pirsch-ignore")&&!r.hasAttribute("data-pirsch-ignore")&&!r.classList.contains("pirsch-ignore")&&(et(r.href)?S||tt(r):P||Z(r))}function Z(a){let r=it(a.href);r!==null&&r.hostname!==location.hostname&&(a.addEventListener("click",()=>pirsch(E,{meta:{url:r.href}})),a.addEventListener("auxclick",()=>pirsch(E,{meta:{url:r.href}})))}function tt(a){let r=nt(a.href);a.addEventListener("click",()=>pirsch(k,{meta:{file:r}})),a.addEventListener("auxclick",()=>pirsch(k,{meta:{file:r}}))}function et(a){let r=a.split(".").pop().toLowerCase();return i.includes(r)}function it(a){try{return new URL(a)}catch{return null}}function nt(a){try{return a.toLowerCase().startsWith("http")?new URL(a).pathname:a??"(empty)"}catch{return"(error)"}}function rt(){window.pirschNotFound=function(){pirsch(G,{meta:{path:location.pathname}})}}})();})();
